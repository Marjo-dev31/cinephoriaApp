<div class="p-4 rounded-lg">
    <form [formGroup]="formModel" (ngSubmit)="onSubmit()" class="flex flex-col">
        <div class="flex flex-col space-y-2">
            @for (control of formModelConfig(); track $index) {
                <label
                    for="control.controlKey"
                    class="capitalize font-semibold mt-2"
                >
                    {{ control.label }} :</label
                >
                <ng-container>
                    @switch (control.formFieldType) {
                        @case ('input') {
                            <input
                                type="{{ control.inputType }}"
                                maxlength="{{ control.maxlength }}"
                                formControlName="{{ control.controlKey }}"
                                class="border bg-sage/40 rounded-lg p-1"
                                [min]="control.min"
                                [max]="control.max"
                                accept="{{ control.accept }}"
                                (change)="onFileSelected($event)"
                            />
                        }
                        @case ('select') {
                            <select
                                formControlName="{{ control.controlKey }}"
                                class="border bg-sage/40"
                            >
                                @for (
                                    option of control.selectOptions;
                                    track $index
                                ) {
                                    <option value="{{ option }}">
                                        {{ option }}
                                    </option>
                                }
                            </select>
                        }
                        @case ('textarea') {
                            <textarea
                                formControlName="{{ control.controlKey }}"
                                class="border bg-sage/40"
                                rows="{{ control.rows }}"
                            >
                            </textarea>
                        }
                    }
                </ng-container>

                @if (
                    formModel.touched &&
                    formModel.get(control.controlKey)?.hasError('required')
                ) {
                    <span class="text-sm text-red-600"
                        >Veuillez compléter ce champ</span
                    >
                }
                @if (
                    formModel.get(control.controlKey)?.hasError('minlength') ||
                    formModel.get(control.controlKey)?.hasError('maxlength') ||
                    formModel.get(control.controlKey)?.hasError('pattern')
                ) {
                    @if (control.controlKey === 'cardNumber') {
                        <span class="text-red-600 text-sm"
                            >Veuillez respecter les indications : Le numéro de
                            carte bancaire doit être composé de 16
                            chiffres</span
                        >
                    }
                    @if (control.controlKey === 'code') {
                        <span class="text-red-600 text-sm"
                            >Le code est de 3 chiffres</span
                        >
                    }
                    @if (control.controlKey === 'password') {
                        <span class="text-red-600 text-sm"
                            >Le mot de passe doit être composé de 12 caractères
                            dont 1 chiffre, 1 majuscule, 1 minuscule et 1 des
                            caractères spéciaux</span
                        >
                    }
                }
                @if(formModel.get(control.controlKey)?.hasError('email')){
                    <span class="text-red-600 text-sm">Le format de mail est incorrect</span>
                }
                @if( control.controlKey === 'confirmPassword'){
                    @if(formModel.get('password')?.value !== formModel.get('confirmPassword')?.value){
                        <span class="text-red-600 text-sm">Le password et sa confirmation doivent être identiques</span>
                    }
                }
            }
        </div>
        <div class="flex justify-evenly mt-10 &_>button:rounded-lg ">
            <button
                type="submit"
                [disabled]="formModel.invalid"
                class="border w-1/3 h-8 rounded-lg bg-seasalt text-darkblue p-4 disabled:opacity-30 disabled:cursor-not-allowed"
            >
                Valider
            </button>
        </div>
    </form>
</div>
